# Typeflow — тренажёр слепой печати

Краткое описание проекта, архитектура и навигация по коду.

---

## Суть проекта

**Typeflow** — десктопное приложение для обучения слепой печати (на русской и английской раскладке). Стилистика — тёмная тема в духе Minecraft (шрифт Press Start 2P, сундук, алмазы, звуки).

**Основные возможности:**
- Выбор языка интерфейса и уроков: **русский** или **English**
- Два трека: **Новичок** (с нуля: позиция пальцев → слова) и **Продвинутый** (скорость)
- Пошаговые уроки: показывается слово/фраза, пользователь вводит его и нажимает Enter
- Подсветка ввода: зелёный — верно, красный — ошибка, серо-голубой — текущий символ
- Точность < 80% — слово повторяется; ≥ 80% — переход к следующему
- Подсчёт WPM (слов в минуту), точности, сохранение истории в CSV
- Геймификация: алмазы за точность ≥ 90%, окно «сундука», звуки (победа, ошибка, переход уровня и т.д.)
- Переход на следующий уровень после прохождения текущего; в конце — итоговый отчёт

---

## Архитектура

```
┌─────────────────────────────────────────────────────────────────┐
│  main.py                                                         │
│  • Точка входа                                                   │
│  • StartScreen: выбор языка (ru/en), трека (beginner/advanced)  │
│  • По кнопке «Начать обучение» — destroy окна, новое окно + GUI  │
└───────────────────────────┬─────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  gui.py — TypingGUI                                              │
│  • Окно тренировки: Canvas (слово), Entry (ввод), статистика     │
│  • Фон (PIL/training.png), меню (Файл, Статистика), сундук       │
│  • Обработка ввода: on_key_release, submit_current, update_*    │
│  • Использует: core.TypingSession, lessons.get_lesson/get_next   │
└───────────────────────────┬─────────────────────────────────────┘
                             │
         ┌───────────────────┼───────────────────┐
         ▼                   ▼                   ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  core.py     │    │  lessons.py  │    │  config.py   │
│  TypingSession│   │  LESSONS,    │    │  цвета, шрифт│
│  submit(),   │    │  get_lesson(),│   │  LANGUAGE,   │
│  save_csv()  │    │  get_next_   │    │  set_language│
│              │    │  level()     │    │  KEYBOARD_   │
│              │    │              │    │  LAYOUT      │
└──────────────┘    └──────────────┘    └──────────────┘
```

**Поток данных:**
1. Пользователь выбирает язык и трек на **StartScreen** → вызывается `set_language(lang)` в config.
2. При старте тренировки создаётся **TypingSession**(track, level_key, language) — урок подгружается через **lessons.get_lesson()**.
3. Каждый ввод (Enter или полное совпадение длины) → **session.submit(user_input)** → core возвращает accuracy, wpm, repeat, done.
4. При `done` и наличии следующего уровня — обновляется level_key и загружается новый урок; иначе показывается финальный отчёт и **save_session_to_csv()**.

---

## Структура файлов и где что искать

| Файл | Назначение |
|------|------------|
| **main.py** | Точка входа. Класс **StartScreen**: экран приветствия, выбор языка/уровня, кнопка «Начать обучение», переход в новое окно с **TypingGUI**. |
| **gui.py** | Класс **TypingGUI**: окно тренировки, поле ввода, отображение слова, подсветка символов (**update_highlighting**), отправка (**submit_current**), меню, сундук, фон, звуки (**play_sound**), переход уровней (**load_next_level**), финальный отчёт (**show_final_report**). |
| **core.py** | Класс **TypingSession**: текущее слово (**get_current_target**), отправка (**submit**), подсчёт точности/WPM, правило повтора (<80%), финальная статистика (**get_final_stats**). Функция **save_session_to_csv** — запись в `typing_history.csv`. |
| **lessons.py** | Словарь **LESSONS** (beginner / advanced, уровни 1_fingers … 10_sentences и 1_drills … 5_free_typing). **get_lesson(track, level_key, language)** — список строк урока (для ru — перевод через **trans_map**). **get_next_level(track, level_key)** — ключ следующего уровня или None. |
| **config.py** | **LANGUAGE**, цвета (BG_COLOR, FG_COLOR, ACCENT_COLOR, CORRECT_COLOR, ERROR_COLOR, CURRENT_BG), шрифты (FONT_FAMILY, Press Start 2P), **set_language(lang)**, **KEYBOARD_LAYOUT** (для подсказок). |
| **setup_chest.py** | Закомментированный скрипт для подготовки текстур сундука (chest_open/chest_closed). |

**Ресурсы:**
- **textures/** — фоны (`background/start.png`, `training.png`, `history.png`), `chest_closed.png`, `chest_open.png`, и др.
- **sounds/** — WAV: победа, ошибка, переход уровня, закрытие, сундук и т.д. Воспроизведение через `paplay` (Linux).
- **typing_history.csv** — история сессий (дата, track, level, wpm, accuracy, words, time_sec); создаётся при первом сохранении.

---

## Зависимости

- **Python 3** с **tkinter**
- **Pillow (PIL)** — загрузка и масштабирование фонов/сундука
- **paplay** (пакет `pulseaudio-utils`) — для звуков под Linux

Запуск: из корня проекта выполнить `python main.py` (или `python3 main.py`).

---

## Важные места в коде

- **Старт приложения и переход в тренировку:** `main.py` → `StartScreen.start_training()` — создание нового `Tk()` и `TypingGUI(...)`.
- **Логика «слово принято / повтор / конец урока»:** `core.py` → `TypingSession.submit()` (accuracy < 80% → repeat; иначе index += 1; done = index >= len(exercises)).
- **Отображение слова и подсветка по символам:** `gui.py` → `update_highlighting(typed)`, рисование прямоугольников на Canvas.
- **Автоотправка при полном вводе:** `gui.py` → `on_key_release()` — при `len(typed) == target_len` вызывается `submit_current` через `after(50, ...)`.
- **Переход на следующий уровень:** `gui.py` → `submit_current()` при `result["done"]` и `get_next_level()` не None → обновление session, сообщение «Уровень пройден», по Enter — `load_next_level()` и `update_prompt()`.
- **Сохранение статистики:** `core.py` → `save_session_to_csv(session)` — дописывание строки в `typing_history.csv`.
- **Русские уроки:** `lessons.py` → `get_lesson(..., language="ru")` использует словарь `trans_map` для перевода английских строк в русские.

---

## Итог

**Typeflow** — тренажёр слепой печати с двумя треками и мультиязычными уроками. Архитектура: **main** (стартовый экран) → **gui** (интерфейс тренировки) → **core** (сессия и статистика) + **lessons** (контент) и **config** (настройки). По этому файлу можно быстро понять суть проекта и находить нужные части кода.
